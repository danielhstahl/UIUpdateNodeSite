"use strict";
var Complex=require('Complex'); //exportable class
var FangOosterlee=function(k, h){
	this.k=k;
	this.h=h;
}
FangOosterlee.prototype.computeDistribution=function(chrFunc, xmin, xmax){
	var xRange=xmax-xmin;
	var h=this.h; //for speed purposes
	var du=Math.PI/xRange;
	var dx=xRange/(h-1.0);
	var k=this.k; //for speed purposes
	var cp=2.0/xRange;
	var f=[];
	var y=[];
	var x=[];
    var denominator=k;
	for(var j=0; j<k; j++){
        var updateRatio=(j*100)/denominator;
       // self.postMessage({update: updateRatio+'%'}); 
        process.send({update:updateRatio+'%'});
		var u=new Complex(0, du*j);
		f[j]=chrFunc.execute(u).multiply(u.multiply(new Complex(-xmin, 0)).exp()).real*cp;
	}
	f[0]=.5*f[0];
	for(var i=0; i<h; i++){
		y[i]=0;
		x[i]=xmin+dx*i;
		for(var j=0; j<k; j++){
			y[i]=y[i]+f[j]*Math.cos(du*j*dx*i);
		}
	}
	var distribution={};
	distribution["x"]=x;
	distribution["y"]=y;
	return distribution;
}
module.exports=FangOosterlee; //exportable class